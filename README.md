# ProbeTools
<b>Flexible, user-friendly hybridization probe design for diverse viral taxa</b>

ProbeTools is a collection of Python scripts for designing hybridization probe sequences against viral taxa with extensive genomic diversity. It uses a heuristic k-mer clustering algorithm. All probe-length k-mers are enumerated from a set of provided reference genomes, then these k-mers are clustered based on nucleotide sequence similarity. Centroids sequences, i.e. the k-mers that seeded each cluster, are extracted as candidate probe sequences. Centroids are ranked based on the number of k-mers in the clusters they represent, and centroids from larger clusters are assumed to make better probes because of their similarity to more k-mers within the provided reference sequence target space. This process can be improved by designing probe panels incrementally, adding smaller batches of probes and removing already-covered sub-sequences from the target space between batches.

ProbeTools consists of four Python scripts for probe design applications:
1. <b>makeprobes.py</b>: enumerates probe-length k-mers from target space FASTA file, clusters k-mers, and ranks candidate probe sequences based on cluster sizes
2. <b>capture.py</b>: predicts target space coverage by provided probe panel
3. <b>getlowcov.py</b>: extracts sub-sequences from target with low probe coverage and writes them to a new FASTA file
4. <b>stats.py</b>: calculates statistics about the depth and extent of target space coverage by provided probe panel

The ProbeTools scripts are modular and can be chained together in various ways to achieve the desired result. The following approach is recommended as a departure point for probe design projects:
1. <b>Optional target space pre-clustering:</b> This can be done using any clustering program, e.g. VSEARCH (REFERENCE). This step is optional and will depend on the intended purpose of the probe panel. Certain viral taxa are over-represented in databases where viral sequences are obtained, usually due to their agricultural and/or public health significance. ProbeTools will bias its designs towards over-represented sequences and the k-mers they contain. If the purpose of the panel is disease surveillance and detection of reportable viral taxa, this ProbeTools bias could be considered a feature more than a flaw, and target space pre-clustering might be undesirable. If the purpose of the panel is the recovery lineages that are not as well represented in sequence databases, pre-clustering is probably appropriate. Depending on the size, number, and complexity of viral genomes, this pre-clustering step might also be computationally expensive and impractical.
2. <b>Single batch designs to estimate required panel size:</b> Run makeprobes.py once, generating the full panel. Create smaller panels covering a range of sizes by copying the top-n probe sequences from the full panel. Since probe sequences are outputted in descending order of predicted inclusivity, this approach will generate the most effective panels across this range of panel sizes. Coverage predictions for these panels can be generated by running capture.py and stats.py for each panel. These results will provide a rough indication of how many probe sequences will be required to achieve a desired level of target space coverage. They might also indicate a panel size where additional probes from the single-batch design provide diminishing marginal target coverage.
3. <b>Incremental batch designs to improve panel coverage:</b> Run makeprobes.py, generating one tenth of the total number of probes anticipated. Run capture.py on this batch of probes, then run getlowcov.py to create a FASTA containing all parts of the target space not covered by this batch. Run makeprobes.py again, still generating one tenth of the total number of probes anticipated, but this time run it on the FASTA file created by getlowcov.py. Repeat this process until the total anticipated number of probes has been generated, and combine all batches of probes into one panel. Run capture.py and stats.py on the combined panel and compare the target space coverage metrics to a panel of the same size designed as a single batch. You will notice an improvement from removing already-covered sub-sequences from the target space between batches.

A generalized incremental design strategy has been implemented in a convenient bash script called incrementalprobes.sh. The user provides the following:
1. A FASTA file containing viral reference sequences
2. The number of probes designed per batch
3. The level of coverage desired for the top 90% of reference sequences
4. The maxmimum number of probes in the panel

The incrementalprobes.sh script will perform an incremental design strategy on the provided target space, adding the indicated number of probes each batch. It will continue adding batches until the desired coverage target is achieved or the panel contains the maximum number of probes, whichever occurs first. Smaller batch sizes will result in better coverage from more compact panel sizes, but increase the computation time required for the design.

# ProbeTools Setup

